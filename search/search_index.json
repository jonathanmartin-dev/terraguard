{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83d\udee1\ufe0f Terraguard","text":"<p>A lightweight, multi-cloud Terraform plan risk assessor designed for Continuous Integration (CI) environments, specifically GitHub Actions. It analyzes resource changes in a Terraform plan and determines a risk level, optionally failing the CI build for required manual review.</p>"},{"location":"#documentation","title":"\ud83d\udcda Documentation","text":"<p>For detailed documentation, including API reference, configuration guides, and more examples, visit the documentation site.</p>"},{"location":"#features","title":"\ud83d\ude80 Features","text":"<ul> <li>Risk Scoring: Assigns a risk level (LOW, MEDIUM, HIGH) and a numeric score to the entire Terraform plan.</li> <li>Configurable Sensitivity: Uses external configuration (e.g., <code>risk_config.json</code>) with Regular Expressions to identify high-risk resources across any provider (AWS, GCP, Azure, Kubernetes, etc.).</li> <li>CI Gating: Fails the CI/CD pipeline if the assessed risk exceeds a configured threshold (e.g., fail on <code>MEDIUM</code> or <code>HIGH</code>).</li> <li>GitHub Integration: Automatically posts a formatted summary of the risk assessment as a comment on the associated Pull Request.</li> </ul>"},{"location":"#installation","title":"\u2699\ufe0f Installation","text":"<p>The best practice is to install the package in an isolated virtual environment (<code>.venv</code>) or directly within your CI environment.</p>"},{"location":"#1-requirements","title":"1. Requirements","text":"<ul> <li>Python 3.8+</li> <li>A generated Terraform plan JSON file (from <code>terraform show -json ...</code>).</li> </ul>"},{"location":"#2-install-from-source","title":"2. Install from Source","text":"<p>Navigate to the project root directory and run:</p> <pre><code># Install the package in editable mode for development\npip install -e .\n</code></pre>"},{"location":"#usage","title":"\ud83d\udcd6 Usage","text":"<p>After installation, you can use the <code>tguard</code> command to assess risk in your Terraform plan JSON files.</p>"},{"location":"#basic-usage","title":"Basic Usage","text":"<pre><code>tguard &lt;path-to-terraform-plan.json&gt;\n</code></pre>"},{"location":"#example","title":"Example","text":"<pre><code>tguard tests/fixtures/vpc.tfplan.json\n</code></pre> <p>Example Output:</p> <pre><code>### Terraform Plan Risk Assessment\n\n**Risk Level:** `HIGH` (score: 90)\n\n**Change Summary:**\n- Total resources with changes: `31`\n- Creates: `31`\n- Updates: `0`\n- Deletes: `0`\n- High risk changes: `0`\n- Critical changes: `0`\n- High risk deletes: `0`\n- Critical deletes: `0`\n\n**Reasons / Signals:**\n- 31 resource(s) will be changed (create/update/delete).\n- High count of changes or deletions (Blast Radius).\n\n\nRisk level `HIGH` is &gt;= fail-on threshold `HIGH`. Failing for manual review.\n</code></pre> <p>The tool will exit with a non-zero status code if the assessed risk level meets or exceeds the configured threshold (default: <code>HIGH</code>), making it suitable for CI/CD pipeline gating.</p>"},{"location":"#using-a-custom-risk-configuration","title":"Using a Custom Risk Configuration","text":"<p>You can specify your own risk configuration file using the <code>--risk-config-path</code> option:</p> <pre><code>tguard tests/fixtures/vpc.tfplan.json --risk-config-path ./my-custom-risk-config.json\n</code></pre> <p>Or set it via environment variable:</p> <pre><code>export RISK_CONFIG_PATH=./my-custom-risk-config.json\ntguard tests/fixtures/vpc.tfplan.json\n</code></pre> <p>Example Risk Configuration (<code>risk_config.json</code>):</p> <pre><code>{\n  \"resource_risk_patterns\": [\n    {\n      \"pattern\": \"^aws_iam_.*\",\n      \"risk_level\": \"CRITICAL\",\n      \"reason\": \"Identity and Access Management resources are highly sensitive.\"\n    },\n    {\n      \"pattern\": \"^aws_security_group$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Firewall rules control network access.\"\n    },\n    {\n      \"pattern\": \"^aws_db_instance$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Database changes risk data integrity/availability.\"\n    }\n  ],\n  \"default_risk_level\": \"LOW\"\n}\n</code></pre> <p>The configuration uses regular expressions to match Terraform resource types and assign risk levels. Patterns are evaluated in order, and the highest matching risk level is used.</p>"},{"location":"#development-setup","title":"\ud83d\udee0\ufe0f Development Setup","text":"<p>To set up the project for development:</p>"},{"location":"#1-create-a-virtual-environment","title":"1. Create a Virtual Environment","text":"<pre><code>python3 -m venv .venv\n</code></pre>"},{"location":"#2-activate-the-virtual-environment","title":"2. Activate the Virtual Environment","text":"<p>On macOS/Linux:</p> <pre><code>source .venv/bin/activate\n</code></pre> <p>On Windows:</p> <pre><code>.venv\\Scripts\\activate\n</code></pre>"},{"location":"#3-install-development-dependencies","title":"3. Install Development Dependencies","text":"<pre><code># Install the package with all development dependencies\npip install -e \".[dev]\"\n</code></pre> <p>This will install:</p> <ul> <li>Documentation tools: mkdocs, mkdocs-material, mkdocstrings, and plugins</li> <li>Code formatting: black</li> <li>Type checking: mypy</li> <li>Testing: pytest, pytest-cov</li> <li>Linting: ruff</li> <li>Pre-commit hooks: pre-commit</li> </ul>"},{"location":"#4-set-up-pre-commit-hooks-optional","title":"4. Set Up Pre-commit Hooks (Optional)","text":"<pre><code>pre-commit install\n</code></pre> <p>This will automatically run code quality checks (formatting, linting) before each commit.</p>"},{"location":"configuration/","title":"Risk Configuration","text":"<p>The dynamic approvals bot uses a JSON configuration file to map Terraform resource types to risk levels using regular expression patterns.</p>"},{"location":"configuration/#configuration-file-format","title":"Configuration File Format","text":"<p>The risk configuration is a JSON file with the following structure:</p> <pre><code>{\n  \"default_risk_level\": \"LOW\",\n  \"resource_risk_patterns\": [\n    {\n      \"pattern\": \"^aws_iam_.*\",\n      \"risk_level\": \"CRITICAL\",\n      \"reason\": \"Identity and Access Management resources are highly sensitive.\"\n    },\n    {\n      \"pattern\": \"^aws_security_group$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Firewall rules control network access.\"\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/#configuration-fields","title":"Configuration Fields","text":"<ul> <li> <p><code>default_risk_level</code> (string, required): The default risk level assigned to resources that don't match any pattern. Must be one of: <code>LOW</code>, <code>MEDIUM</code>, <code>HIGH</code>.</p> </li> <li> <p><code>resource_risk_patterns</code> (array, optional): List of pattern objects that define how resource types are mapped to risk levels.</p> </li> </ul>"},{"location":"configuration/#pattern-object-fields","title":"Pattern Object Fields","text":"<p>Each pattern object in <code>resource_risk_patterns</code> contains:</p> <ul> <li> <p><code>pattern</code> (string, required): A regular expression pattern that matches against Terraform resource types (e.g., <code>aws_s3_bucket</code>, <code>google_compute_instance</code>). The pattern is matched using Python's <code>re.match()</code> function.</p> </li> <li> <p>risk_level (string, required): The risk level to assign when this pattern matches. Must be one of: <code>LOW</code>, <code>MEDIUM</code>, <code>HIGH</code>, or <code>CRITICAL</code>.</p> </li> <li> <p>reason (string, optional): A human-readable explanation for why this resource type has this risk level. Used in risk assessment output.</p> </li> </ul>"},{"location":"configuration/#pattern-matching-behavior","title":"Pattern Matching Behavior","text":"<ol> <li>Patterns are evaluated in order</li> <li>All matching patterns are considered</li> <li>The highest risk level from all matches is selected</li> <li>If no patterns match, the <code>default_risk_level</code> is used</li> </ol>"},{"location":"configuration/#risk-levels","title":"Risk Levels","text":"<p>The tool supports the following risk levels (in order of severity):</p> <ul> <li>LOW: Minimal risk changes</li> <li>MEDIUM: Moderate risk requiring review</li> <li>HIGH: High risk requiring manual approval</li> <li>CRITICAL: Critical risk (treated as HIGH in final assessment)</li> </ul> <p>Note: While <code>CRITICAL</code> can be used in configuration patterns, the final risk assessment only outputs <code>LOW</code>, <code>MEDIUM</code>, or <code>HIGH</code>. <code>CRITICAL</code> resources are counted separately and contribute to raising the overall risk level.</p>"},{"location":"configuration/#example-configuration","title":"Example Configuration","text":"<p>Here's a comprehensive example covering multiple cloud providers:</p> <pre><code>{\n  \"default_risk_level\": \"LOW\",\n  \"resource_risk_patterns\": [\n    {\n      \"pattern\": \"^aws_iam_.*\",\n      \"risk_level\": \"CRITICAL\",\n      \"reason\": \"Identity and Access Management resources are highly sensitive.\"\n    },\n    {\n      \"pattern\": \"^aws_security_group$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Firewall rules control network access.\"\n    },\n    {\n      \"pattern\": \"^aws_db_instance$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Database changes risk data integrity/availability.\"\n    },\n    {\n      \"pattern\": \"^google_compute_firewall$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"GCP network access control.\"\n    },\n    {\n      \"pattern\": \"^azurerm_network_security_group$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Azure network access control.\"\n    },\n    {\n      \"pattern\": \"^aws_vpc$\",\n      \"risk_level\": \"MEDIUM\",\n      \"reason\": \"VPC/Network changes impact connectivity.\"\n    },\n    {\n      \"pattern\": \".*null_resource.*\",\n      \"risk_level\": \"LOW\",\n      \"reason\": \"Generally benign resource.\"\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/#pattern-examples","title":"Pattern Examples","text":""},{"location":"configuration/#match-all-iam-resources","title":"Match All IAM Resources","text":"<pre><code>{\n  \"pattern\": \"^aws_iam_.*\",\n  \"risk_level\": \"CRITICAL\",\n  \"reason\": \"All IAM resources are critical\"\n}\n</code></pre>"},{"location":"configuration/#match-specific-resource-type","title":"Match Specific Resource Type","text":"<pre><code>{\n  \"pattern\": \"^aws_s3_bucket$\",\n  \"risk_level\": \"HIGH\",\n  \"reason\": \"S3 buckets store data\"\n}\n</code></pre>"},{"location":"configuration/#match-multiple-providers","title":"Match Multiple Providers","text":"<pre><code>{\n  \"pattern\": \".*_firewall$\",\n  \"risk_level\": \"HIGH\",\n  \"reason\": \"Firewall rules across all providers\"\n}\n</code></pre>"},{"location":"configuration/#match-resources-with-specific-prefix","title":"Match Resources with Specific Prefix","text":"<pre><code>{\n  \"pattern\": \"^aws_rds_.*\",\n  \"risk_level\": \"HIGH\",\n  \"reason\": \"RDS database resources\"\n}\n</code></pre>"},{"location":"configuration/#using-custom-configuration","title":"Using Custom Configuration","text":""},{"location":"configuration/#command-line","title":"Command-Line","text":"<pre><code>tguard plan.json --risk-config-path ./custom-risk-config.json\n</code></pre>"},{"location":"configuration/#environment-variable","title":"Environment Variable","text":"<pre><code>export RISK_CONFIG_PATH=./custom-risk-config.json\ntguard plan.json\n</code></pre>"},{"location":"configuration/#default-location","title":"Default Location","text":"<p>If no configuration path is provided, the tool uses the built-in configuration at: <code>src/terraguard/risk/risk_config.json</code></p>"},{"location":"configuration/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Order patterns from most specific to least specific: More specific patterns should come first to avoid unintended matches.</p> </li> <li> <p>Use anchors appropriately:</p> </li> <li><code>^pattern$</code> - Exact match</li> <li><code>^pattern.*</code> - Starts with pattern</li> <li><code>.*pattern$</code> - Ends with pattern</li> <li> <p><code>.*pattern.*</code> - Contains pattern</p> </li> <li> <p>Document reasons: Always include a clear <code>reason</code> field to help reviewers understand why a resource type has a particular risk level.</p> </li> <li> <p>Test patterns: Use a regex tester to verify your patterns match the intended resource types.</p> </li> <li> <p>Start conservative: Begin with a <code>LOW</code> default and explicitly mark high-risk resources. You can always adjust later.</p> </li> </ol>"},{"location":"usage/","title":"Usage Guide","text":""},{"location":"usage/#basic-usage","title":"Basic Usage","text":"<p>Terraguard analyzes Terraform plan JSON files and assesses risk levels.</p>"},{"location":"usage/#generate-terraform-plan-json","title":"Generate Terraform Plan JSON","text":"<p>First, generate a Terraform plan and convert it to JSON:</p> <pre><code>terraform plan -out=plan.out\nterraform show -json plan.out &gt; plan.json\n</code></pre>"},{"location":"usage/#run-risk-assessment","title":"Run Risk Assessment","text":"<pre><code>tguard plan.json\n</code></pre> <p>The tool will:</p> <ul> <li>Analyze the plan and assess risk</li> <li>Print a markdown summary to stdout</li> <li>Optionally post a comment to GitHub (if running in GitHub Actions)</li> <li>Exit with code 1 if risk exceeds threshold</li> </ul>"},{"location":"usage/#command-line-options","title":"Command-Line Options","text":""},{"location":"usage/#required-arguments","title":"Required Arguments","text":"<ul> <li><code>plan_json</code>: Path to Terraform plan JSON file (from <code>terraform show -json plan.out &gt; plan.json</code>)</li> </ul>"},{"location":"usage/#optional-arguments","title":"Optional Arguments","text":"<ul> <li> <p><code>--risk-config-path PATH</code>: Path to the risk configuration JSON file. Overrides <code>RISK_CONFIG_PATH</code> environment variable. If not provided, defaults to the built-in configuration.</p> </li> <li> <p><code>--fail-on {LOW,MEDIUM,HIGH}</code>: Fail (exit code 1) if risk level is at or above this threshold. Defaults to <code>FAIL_ON_RISK_LEVEL</code> environment variable or <code>HIGH</code> if not set.</p> </li> <li> <p><code>--no-github-comment</code>: Do not attempt to post a comment to GitHub, even if running in GitHub Actions.</p> </li> </ul>"},{"location":"usage/#environment-variables","title":"Environment Variables","text":"<ul> <li><code>RISK_CONFIG_PATH</code>: Path to custom risk configuration JSON file</li> <li><code>FAIL_ON_RISK_LEVEL</code>: Risk level threshold for failing the build (<code>LOW</code>, <code>MEDIUM</code>, or <code>HIGH</code>)</li> <li><code>GITHUB_TOKEN</code>: GitHub personal access token (required for GitHub Actions integration)</li> <li><code>GITHUB_EVENT_PATH</code>: Path to GitHub Actions event JSON (automatically set in GitHub Actions)</li> </ul>"},{"location":"usage/#exit-codes","title":"Exit Codes","text":"<ul> <li><code>0</code>: Risk level is below the fail-on threshold</li> <li><code>1</code>: Risk level meets or exceeds the fail-on threshold (requires manual review)</li> </ul>"},{"location":"usage/#examples","title":"Examples","text":""},{"location":"usage/#basic-assessment","title":"Basic Assessment","text":"<pre><code>tguard tests/fixtures/vpc.tfplan.json\n</code></pre> <p>Example Output:</p> <pre><code>### Terraform Plan Risk Assessment\n\n**Risk Level:** `HIGH` (score: 90)\n\n**Change Summary:**\n- Total resources with changes: `31`\n- Creates: `31`\n- Updates: `0`\n- Deletes: `0`\n- High risk changes: `0`\n- Critical changes: `0`\n- High risk deletes: `0`\n- Critical deletes: `0`\n\n**Reasons / Signals:**\n- 31 resource(s) will be changed (create/update/delete).\n- High count of changes or deletions (Blast Radius).\n\n\nRisk level `HIGH` is &gt;= fail-on threshold `HIGH`. Failing for manual review.\n</code></pre>"},{"location":"usage/#custom-risk-configuration","title":"Custom Risk Configuration","text":"<pre><code>tguard tests/fixtures/vpc.tfplan.json --risk-config-path ./my-custom-risk-config.json\n</code></pre> <p>Or set it via environment variable:</p> <pre><code>export RISK_CONFIG_PATH=./my-custom-risk-config.json\ntguard tests/fixtures/vpc.tfplan.json\n</code></pre> <p>Example Risk Configuration (<code>risk_config.json</code>):</p> <pre><code>{\n  \"resource_risk_patterns\": [\n    {\n      \"pattern\": \"^aws_iam_.*\",\n      \"risk_level\": \"CRITICAL\",\n      \"reason\": \"Identity and Access Management resources are highly sensitive.\"\n    },\n    {\n      \"pattern\": \"^aws_security_group$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Firewall rules control network access.\"\n    },\n    {\n      \"pattern\": \"^aws_db_instance$\",\n      \"risk_level\": \"HIGH\",\n      \"reason\": \"Database changes risk data integrity/availability.\"\n    }\n  ],\n  \"default_risk_level\": \"LOW\"\n}\n</code></pre> <p>The configuration uses regular expressions to match Terraform resource types and assign risk levels. Patterns are evaluated in order, and the highest matching risk level is used.</p>"},{"location":"usage/#fail-on-medium-risk","title":"Fail on Medium Risk","text":"<pre><code>tguard plan.json --fail-on MEDIUM\n</code></pre>"},{"location":"usage/#disable-github-comments","title":"Disable GitHub Comments","text":"<pre><code>tguard plan.json --no-github-comment\n</code></pre>"},{"location":"usage/#using-environment-variables","title":"Using Environment Variables","text":"<pre><code>export FAIL_ON_RISK_LEVEL=MEDIUM\nexport RISK_CONFIG_PATH=./my-config.json\ntguard plan.json\n</code></pre>"},{"location":"usage/#github-actions-integration","title":"GitHub Actions Integration","text":"<p>Terraguard automatically detects when running in GitHub Actions and will post comments to pull requests if:</p> <ol> <li>The workflow is triggered by a <code>pull_request</code> or <code>pull_request_target</code> event</li> <li><code>GITHUB_TOKEN</code> environment variable is set (usually automatic in GitHub Actions)</li> <li><code>--no-github-comment</code> flag is not used</li> </ol>"},{"location":"usage/#example-github-actions-workflow","title":"Example GitHub Actions Workflow","text":"<pre><code>name: Terraform Risk Assessment\n\non:\n  pull_request:\n    paths:\n      - \"terraform/**\"\n\njobs:\n  assess-risk:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Setup Terraform\n        uses: hashicorp/setup-terraform@v2\n        with:\n          terraform_version: 1.5.0\n\n      - name: Terraform Plan\n        working-directory: ./terraform\n        run: |\n          terraform init\n          terraform plan -out=plan.out\n          terraform show -json plan.out &gt; ../plan.json\n\n      - name: Install Terraguard\n        run: pip install -e .\n\n      - name: Assess Risk\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n        run: tguard plan.json --fail-on MEDIUM\n</code></pre>"},{"location":"api/","title":"API Reference","text":"<p>Complete API documentation for the dynamic approvals bot, organized by functional area.</p>"},{"location":"api/#modules","title":"Modules","text":"<ul> <li>CLI - Command-line interface and entry point</li> <li>Configuration - Settings and risk level management</li> <li>Terraform Plan - Plan loading and change summarization</li> <li>Risk Assessment - Risk configuration and assessment rules</li> <li>Outputs - Markdown formatting and GitHub integration</li> </ul>"},{"location":"api/cli/","title":"CLI Module","text":"<p>The command-line interface provides the main entry point for the application.</p> <p>Command-line interface for the dynamic approvals bot.</p> <p>This module provides the main entry point for assessing Terraform plan risk and optionally gating CI/CD approvals based on the assessed risk level.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/cli/#terraguard.cli.main","title":"<code>main()</code>","text":"<p>Main entry point for the dynamic approvals bot.</p> <p>Loads and analyzes a Terraform plan, assesses risk, formats output, optionally posts to GitHub, and exits with appropriate code based on the risk level threshold.</p> <p>Exits with code 1 if risk level meets or exceeds the fail-on threshold, otherwise exits with code 0.</p> Source code in <code>src/terraguard/cli.py</code> <pre><code>def main() -&gt; None:\n    \"\"\"Main entry point for the dynamic approvals bot.\n\n    Loads and analyzes a Terraform plan, assesses risk, formats output,\n    optionally posts to GitHub, and exits with appropriate code based on\n    the risk level threshold.\n\n    Exits with code 1 if risk level meets or exceeds the fail-on threshold,\n    otherwise exits with code 0.\n    \"\"\"\n    args = parse_args()\n    DEFAULT_RISK_CONFIG_PATH = os.path.join(os.path.dirname(__file__), \"risk\", \"risk_config.json\")\n    risk_config_path = args.risk_config_path or DEFAULT_RISK_CONFIG_PATH\n    settings = get_settings(\n        arg_fail_on=args.fail_on,\n        arg_no_github_comment=args.no_github_comment,\n    )\n\n    try:\n        plan = load_plan_json(args.plan_json)\n    except Exception as e:\n        print(f\"ERROR: Failed to load plan JSON from {args.plan_json}: {e}\", file=sys.stderr)\n        sys.exit(1)\n\n    risk_config = load_risk_config(risk_config_path)\n\n    stats = summarize_changes(plan, risk_config)\n    result = assess_risk(stats)\n    summary_md = format_summary_markdown(result)\n\n    # Always print markdown summary to stdout so logs show it.\n    print(summary_md)\n\n    # Optionally post to GitHub\n    maybe_post_github_comment(summary_md)\n\n    # Decide exit code based on risk vs threshold\n    current_level = result[\"level\"]\n    fail_on = settings.fail_on_risk_level\n\n    if RISK_LEVEL_ORDER.index(current_level) &gt;= RISK_LEVEL_ORDER.index(fail_on):\n        print(\n            f\"\\nRisk level `{current_level}` is &gt;= fail-on threshold `{fail_on}`. \"\n            f\"Failing for manual review.\",\n            file=sys.stderr,\n        )\n        sys.exit(1)\n\n    print(\n        f\"\\nRisk level `{current_level}` is below fail-on threshold `{fail_on}`. \" f\"Continuing.\",\n        file=sys.stderr,\n    )\n    sys.exit(0)\n</code></pre>"},{"location":"api/cli/#terraguard.cli.parse_args","title":"<code>parse_args()</code>","text":"<p>Parse command-line arguments.</p> <p>Returns:</p> Type Description <code>Namespace</code> <p>An argparse.Namespace object containing the parsed arguments:</p> <code>Namespace</code> <ul> <li>plan_json: Path to Terraform plan JSON file</li> </ul> <code>Namespace</code> <ul> <li>risk_config_path: Optional path to risk configuration JSON file</li> </ul> <code>Namespace</code> <ul> <li>fail_on: Optional risk level threshold for failing the build</li> </ul> <code>Namespace</code> <ul> <li>no_github_comment: Flag to disable GitHub comment posting</li> </ul> Source code in <code>src/terraguard/cli.py</code> <pre><code>def parse_args() -&gt; argparse.Namespace:\n    \"\"\"Parse command-line arguments.\n\n    Returns:\n        An argparse.Namespace object containing the parsed arguments:\n        - plan_json: Path to Terraform plan JSON file\n        - risk_config_path: Optional path to risk configuration JSON file\n        - fail_on: Optional risk level threshold for failing the build\n        - no_github_comment: Flag to disable GitHub comment posting\n    \"\"\"\n    parser = argparse.ArgumentParser(\n        description=\"Assess risk level of a Terraform plan JSON and optionally gate approvals.\"\n    )\n    parser.add_argument(\n        \"plan_json\",\n        help=\"Path to Terraform plan JSON (from `terraform show -json plan.out &gt; plan.json`).\",\n    )\n    parser.add_argument(\n        \"--risk-config-path\",\n        default=os.getenv(\"RISK_CONFIG_PATH\"),\n        help=\"Path to the risk configuration JSON file. Overrides RISK_CONFIG_PATH env var.\",\n    )\n    parser.add_argument(\n        \"--fail-on\",\n        choices=RISK_LEVEL_ORDER,\n        default=None,\n        help=(\n            \"Fail (exit code 1) if risk level is at or above this. \"\n            \"Default: env FAIL_ON_RISK_LEVEL or HIGH.\"\n        ),\n    )\n    parser.add_argument(\n        \"--no-github-comment\",\n        action=\"store_true\",\n        help=\"Do not attempt to post a comment to GitHub, even if running in Actions.\",\n    )\n    return parser.parse_args()\n</code></pre>"},{"location":"api/config/","title":"Configuration","text":"<p>Configuration management and settings derivation from CLI arguments and environment variables.</p> <p>Configuration and settings management for the dynamic approvals bot.</p> <p>This module defines risk level constants and provides functionality to derive runtime settings from command-line arguments and environment variables.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/config/#terraguard.config.Settings","title":"<code>Settings</code>  <code>dataclass</code>","text":"<p>Runtime settings derived from CLI args and environment.</p> Source code in <code>src/terraguard/config.py</code> <pre><code>@dataclass(frozen=True)\nclass Settings:\n    \"\"\"Runtime settings derived from CLI args and environment.\"\"\"\n\n    # Which risk level (inclusive) should cause a non-zero exit code.\n    fail_on_risk_level: str\n\n    # Whether the script should attempt to post a comment to GitHub.\n    post_github_comment: bool\n</code></pre>"},{"location":"api/config/#terraguard.config.get_settings","title":"<code>get_settings(arg_fail_on, arg_no_github_comment)</code>","text":"<p>Derive runtime settings from CLI arguments and environment variables.</p> <p>Parameters:</p> Name Type Description Default <code>arg_fail_on</code> <code>Optional[str]</code> <p>Risk level threshold from CLI argument, or None.</p> required <code>arg_no_github_comment</code> <code>bool</code> <p>Flag indicating GitHub comments should be disabled.</p> required <p>Returns:</p> Type Description <code>Settings</code> <p>A Settings object with fail_on_risk_level and post_github_comment values.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If an invalid risk level is provided (not in RISK_LEVEL_ORDER).</p> Note <p>The fail_on_risk_level is determined in priority order: 1. CLI argument (arg_fail_on) 2. Environment variable (FAIL_ON_RISK_LEVEL) 3. Default value (\"HIGH\")</p> Source code in <code>src/terraguard/config.py</code> <pre><code>def get_settings(\n    arg_fail_on: Optional[str],\n    arg_no_github_comment: bool,\n) -&gt; Settings:\n    \"\"\"Derive runtime settings from CLI arguments and environment variables.\n\n    Args:\n        arg_fail_on: Risk level threshold from CLI argument, or None.\n        arg_no_github_comment: Flag indicating GitHub comments should be disabled.\n\n    Returns:\n        A Settings object with fail_on_risk_level and post_github_comment values.\n\n    Raises:\n        ValueError: If an invalid risk level is provided (not in RISK_LEVEL_ORDER).\n\n    Note:\n        The fail_on_risk_level is determined in priority order:\n        1. CLI argument (arg_fail_on)\n        2. Environment variable (FAIL_ON_RISK_LEVEL)\n        3. Default value (\"HIGH\")\n    \"\"\"\n    # 1. Determine the source of the risk level\n    env_fail_on = os.getenv(\"FAIL_ON_RISK_LEVEL\")\n    fail_on = arg_fail_on or env_fail_on\n\n    # 2. Validate or set the default\n    if fail_on is not None and fail_on not in RISK_LEVEL_ORDER:\n        # \u26a0\ufe0f Raise an error if an explicit, but invalid, value was provided\n        raise ValueError(f\"Invalid risk level '{fail_on}'. Must be one of {RISK_LEVEL_ORDER}.\")\n\n    # 3. Set the final value (defaulting only if no value was provided)\n    final_fail_on = fail_on if fail_on is not None else \"HIGH\"\n\n    post_github_comment = not arg_no_github_comment\n\n    return Settings(\n        fail_on_risk_level=final_fail_on,\n        post_github_comment=post_github_comment,\n    )\n</code></pre>"},{"location":"api/outputs/","title":"Output Formatting","text":"<p>Modules for formatting and posting risk assessment results.</p>"},{"location":"api/outputs/#markdown-formatter","title":"Markdown Formatter","text":"<p>Formats risk assessment results as markdown for display in logs or GitHub comments.</p> <p>Markdown formatting for risk assessment results.</p> <p>This module provides functionality to format risk assessment results into markdown for display in logs or GitHub comments.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/outputs/#terraguard.outputs.formatter.format_summary_markdown","title":"<code>format_summary_markdown(result)</code>","text":"<p>Format a risk assessment result dictionary into markdown.</p> <p>Parameters:</p> Name Type Description Default <code>result</code> <code>Dict[str, Any]</code> <p>A dictionary containing: - level: Risk level string (LOW, MEDIUM, HIGH) - score: Numeric risk score - stats: Dictionary with change statistics - reasons: List of reason strings explaining the risk assessment</p> required <p>Returns:</p> Type Description <code>str</code> <p>A formatted markdown string suitable for display in logs or GitHub comments.</p> <code>str</code> <p>Includes risk level, score, change summary, reasons, and a collapsible</p> <code>str</code> <p>section for sensitive resource changes.</p> Source code in <code>src/terraguard/outputs/formatter.py</code> <pre><code>def format_summary_markdown(result: Dict[str, Any]) -&gt; str:\n    \"\"\"Format a risk assessment result dictionary into markdown.\n\n    Args:\n        result: A dictionary containing:\n            - level: Risk level string (LOW, MEDIUM, HIGH)\n            - score: Numeric risk score\n            - stats: Dictionary with change statistics\n            - reasons: List of reason strings explaining the risk assessment\n\n    Returns:\n        A formatted markdown string suitable for display in logs or GitHub comments.\n        Includes risk level, score, change summary, reasons, and a collapsible\n        section for sensitive resource changes.\n    \"\"\"\n    level = result[\"level\"]\n    stats = result[\"stats\"]\n    reasons = result[\"reasons\"]\n\n    lines = []\n    lines.append(\"### Terraform Plan Risk Assessment\")\n    lines.append(\"\")\n    lines.append(f\"**Risk Level:** `{level}` (score: {result['score']})\")\n    lines.append(\"\")\n    lines.append(\"**Change Summary:**\")\n    lines.append(f\"- Total resources with changes: `{stats['total_resources']}`\")\n    lines.append(f\"- Creates: `{stats['creates']}`\")\n    lines.append(f\"- Updates: `{stats['updates']}`\")\n    lines.append(f\"- Deletes: `{stats['deletes']}`\")\n    lines.append(f\"- High risk changes: `{stats['high_risk_changes']}`\")\n    lines.append(f\"- Critical changes: `{stats['critical_changes']}`\")\n    lines.append(f\"- High risk deletes: `{stats['high_risk_deletes']}`\")\n    lines.append(f\"- Critical deletes: `{stats['critical_deletes']}`\")\n    lines.append(\"\")\n    if reasons:\n        lines.append(\"**Reasons / Signals:**\")\n        for r in reasons:\n            lines.append(f\"- {r}\")\n        lines.append(\"\")\n    sens_details = stats.get(\"sensitive_details\", [])\n    if sens_details:\n        lines.append(\"&lt;details&gt;\")\n        lines.append(\"&lt;summary&gt;Sensitive resource changes&lt;/summary&gt;\")\n        lines.append(\"\")\n        for rtype, address, risk_level, actions in sens_details:\n            act_str = \",\".join(actions)\n            lines.append(f\"- `{rtype}` `{address}` ({risk_level}) actions: `{act_str}`\")\n        lines.append(\"\")\n        lines.append(\"&lt;/details&gt;\")\n\n    return \"\\n\".join(lines)\n</code></pre>"},{"location":"api/outputs/#github-integration","title":"GitHub Integration","text":"<p>Posts risk assessment summaries as GitHub PR comments when running in GitHub Actions.</p> <p>GitHub Actions integration for posting risk assessment comments.</p> <p>This module handles posting risk assessment summaries as comments on GitHub Pull Requests when running in GitHub Actions environments.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/outputs/#terraguard.outputs.github.maybe_post_github_comment","title":"<code>maybe_post_github_comment(summary_markdown)</code>","text":"<p>If running in GitHub Actions on a PR event, post a comment to the PR. Uses GITHUB_TOKEN and GITHUB_EVENT_PATH.</p> Source code in <code>src/terraguard/outputs/github.py</code> <pre><code>def maybe_post_github_comment(summary_markdown: str) -&gt; None:\n    \"\"\"\n    If running in GitHub Actions on a PR event, post a comment to the PR.\n    Uses GITHUB_TOKEN and GITHUB_EVENT_PATH.\n    \"\"\"\n    gh_token = os.getenv(\"GITHUB_TOKEN\")\n    event_path = os.getenv(\"GITHUB_EVENT_PATH\")\n\n    if not gh_token or not event_path:\n        # Not running in GitHub Actions, or no token.\n        return\n\n    try:\n        with open(event_path, encoding=\"utf-8\") as f:\n            event = json.load(f)\n    except Exception:\n        return\n\n    # Support pull_request and pull_request_target events\n    pr = event.get(\"pull_request\")\n    if not pr:\n        # Not a PR event; nothing to comment on\n        return\n\n    repo = event.get(\"repository\", {})\n    full_name = repo.get(\"full_name\")  # e.g. \"owner/repo\"\n    if not full_name:\n        return\n\n    pr_number = pr.get(\"number\")\n    if not pr_number:\n        return\n\n    url = f\"https://api.github.com/repos/{full_name}/issues/{pr_number}/comments\"\n    headers = {\n        \"Authorization\": f\"Bearer {gh_token}\",\n        \"Accept\": \"application/vnd.github+json\",\n    }\n    payload = {\"body\": summary_markdown}\n\n    try:\n        resp = requests.post(url, headers=headers, json=payload, timeout=10)\n        if resp.status_code &gt;= 300:\n            print(\n                f\"WARNING: Failed to post GitHub comment \"\n                f\"(status={resp.status_code}): {resp.text}\",\n                file=sys.stderr,\n            )\n    except Exception as e:\n        print(f\"WARNING: Exception posting GitHub comment: {e}\", file=sys.stderr)\n</code></pre>"},{"location":"api/risk/","title":"Risk Assessment","text":"<p>Modules for risk configuration and assessment logic.</p>"},{"location":"api/risk/#risk-configuration","title":"Risk Configuration","text":"<p>Loads risk configuration and maps resource types to risk levels using regex patterns.</p> <p>Risk configuration loading and resource type risk mapping.</p> <p>This module provides functionality to load risk configuration from JSON files and map Terraform resource types to risk levels using regex patterns.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/risk/#terraguard.risk.risk.load_risk_config","title":"<code>load_risk_config(path)</code>","text":"<p>Loads risk configuration data from a JSON file, handling path and parsing errors.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str</code> <p>The file system path to the risk_config.json file.</p> required <p>Returns:</p> Type Description <code>Dict[str, Any]</code> <p>The configuration data as a dictionary.</p> <p>Raises:</p> Type Description <code>SystemExit</code> <p>If the file cannot be found or the JSON is invalid.</p> Source code in <code>src/terraguard/risk/risk.py</code> <pre><code>def load_risk_config(path: str) -&gt; Dict[str, Any]:\n    \"\"\"\n    Loads risk configuration data from a JSON file, handling path and parsing errors.\n\n    Args:\n        path: The file system path to the risk_config.json file.\n\n    Returns:\n        The configuration data as a dictionary.\n\n    Raises:\n        SystemExit: If the file cannot be found or the JSON is invalid.\n    \"\"\"\n    if not os.path.exists(path):\n        print(f\"ERROR: Risk configuration file not found at path: {path}\", file=sys.stderr)\n        sys.exit(1)\n\n    try:\n        with open(path, encoding=\"utf-8\") as f:\n            data = f.read()\n        return cast(Dict[str, Any], json.loads(data))\n\n    except json.JSONDecodeError as e:\n        print(f\"ERROR: Failed to parse risk configuration JSON from {path}.\", file=sys.stderr)\n        print(f\"Details: {e}\", file=sys.stderr)\n        sys.exit(1)\n    except Exception as e:\n        print(f\"ERROR: An unexpected error occurred while reading {path}: {e}\", file=sys.stderr)\n        sys.exit(1)\n</code></pre>"},{"location":"api/risk/#terraguard.risk.risk.map_risk_level","title":"<code>map_risk_level(rtype, config)</code>","text":"<p>Map a Terraform resource type to its risk level using regex patterns.</p> <p>Evaluates the resource type against all patterns in the configuration and returns the highest risk level that matches, along with the reason.</p> <p>Parameters:</p> Name Type Description Default <code>rtype</code> <code>str</code> <p>Terraform resource type string (e.g., \"aws_s3_bucket\").</p> required <code>config</code> <code>Dict[str, Any]</code> <p>Risk configuration dictionary containing: - default_risk_level: Default level if no patterns match - resource_risk_patterns: List of pattern dictionaries with:     - pattern: Regex pattern to match against rtype     - risk_level: Risk level if pattern matches     - reason: Explanation for the risk level</p> required <p>Returns:</p> Type Description <code>str</code> <p>A tuple of (risk_level, reason) where:</p> <code>str</code> <ul> <li>risk_level: The highest matching risk level string</li> </ul> <code>Tuple[str, str]</code> <ul> <li>reason: The reason string for the matched pattern, or default message</li> </ul> Source code in <code>src/terraguard/risk/risk.py</code> <pre><code>def map_risk_level(rtype: str, config: Dict[str, Any]) -&gt; Tuple[str, str]:\n    \"\"\"Map a Terraform resource type to its risk level using regex patterns.\n\n    Evaluates the resource type against all patterns in the configuration\n    and returns the highest risk level that matches, along with the reason.\n\n    Args:\n        rtype: Terraform resource type string (e.g., \"aws_s3_bucket\").\n        config: Risk configuration dictionary containing:\n            - default_risk_level: Default level if no patterns match\n            - resource_risk_patterns: List of pattern dictionaries with:\n                - pattern: Regex pattern to match against rtype\n                - risk_level: Risk level if pattern matches\n                - reason: Explanation for the risk level\n\n    Returns:\n        A tuple of (risk_level, reason) where:\n        - risk_level: The highest matching risk level string\n        - reason: The reason string for the matched pattern, or default message\n    \"\"\"\n\n    # Default to LOW if no match is found\n    highest_level = config.get(\"default_risk_level\", \"LOW\")\n    highest_reason = \"No specific pattern matched.\"\n\n    # Iterate through patterns defined in the configuration\n    for item in config.get(\"resource_risk_patterns\", []):\n        pattern = item.get(\"pattern\")\n        level = item.get(\"risk_level\", \"LOW\")\n        reason = item.get(\"reason\", \"Pattern matched.\")\n\n        if re.match(pattern, rtype):\n            # Use the max_level helper function to find the most severe match\n            if max_level(highest_level, level) == level:\n                highest_level = level\n                highest_reason = reason\n\n    return highest_level, highest_reason\n</code></pre>"},{"location":"api/risk/#terraguard.risk.risk.max_level","title":"<code>max_level(current, new)</code>","text":"<p>Return the higher risk level between two risk levels.</p> <p>Parameters:</p> Name Type Description Default <code>current</code> <code>str</code> <p>Current risk level string.</p> required <code>new</code> <code>str</code> <p>New risk level string to compare.</p> required <p>Returns:</p> Type Description <code>str</code> <p>The risk level string with higher severity (new if it's higher,</p> <code>str</code> <p>current otherwise).</p> Note <p>Risk levels are compared using their order in RISK_LEVEL_ORDER.</p> Source code in <code>src/terraguard/risk/risk.py</code> <pre><code>def max_level(current: str, new: str) -&gt; str:\n    \"\"\"Return the higher risk level between two risk levels.\n\n    Args:\n        current: Current risk level string.\n        new: New risk level string to compare.\n\n    Returns:\n        The risk level string with higher severity (new if it's higher,\n        current otherwise).\n\n    Note:\n        Risk levels are compared using their order in RISK_LEVEL_ORDER.\n    \"\"\"\n    if RISK_LEVEL_ORDER.index(new) &gt; RISK_LEVEL_ORDER.index(current):\n        return new\n    return current\n</code></pre>"},{"location":"api/risk/#risk-rules","title":"Risk Rules","text":"<p>Implements the core risk assessment algorithm and scoring logic.</p> <p>Risk assessment rules and scoring logic.</p> <p>This module implements the core risk assessment algorithm that evaluates Terraform plan statistics and determines an overall risk level and score.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/risk/#terraguard.risk.rules.assess_risk","title":"<code>assess_risk(stats)</code>","text":"<p>Assess overall risk level based on Terraform plan statistics.</p> <p>Evaluates various risk signals including critical/high risk changes, deletions, and blast radius (total change count) to determine an overall risk level.</p> <p>Parameters:</p> Name Type Description Default <code>stats</code> <code>Dict[str, Any]</code> <p>Dictionary containing plan statistics: - total_resources: Total number of resources with changes - creates: Number of resources being created - updates: Number of resources being updated - deletes: Number of resources being deleted - high_risk_changes: Number of HIGH risk resources changing - critical_changes: Number of CRITICAL risk resources changing - high_risk_deletes: Number of HIGH risk resources being deleted - critical_deletes: Number of CRITICAL risk resources being deleted</p> required <p>Returns:</p> Type Description <code>Dict[str, Any]</code> <p>A dictionary containing: - level: Risk level string (LOW, MEDIUM, HIGH) - score: Numeric risk score (10, 50, or 90) - reasons: List of reason strings explaining the assessment - stats: The original stats dictionary</p> Source code in <code>src/terraguard/risk/rules.py</code> <pre><code>def assess_risk(stats: Dict[str, Any]) -&gt; Dict[str, Any]:\n    \"\"\"Assess overall risk level based on Terraform plan statistics.\n\n    Evaluates various risk signals including critical/high risk changes,\n    deletions, and blast radius (total change count) to determine an\n    overall risk level.\n\n    Args:\n        stats: Dictionary containing plan statistics:\n            - total_resources: Total number of resources with changes\n            - creates: Number of resources being created\n            - updates: Number of resources being updated\n            - deletes: Number of resources being deleted\n            - high_risk_changes: Number of HIGH risk resources changing\n            - critical_changes: Number of CRITICAL risk resources changing\n            - high_risk_deletes: Number of HIGH risk resources being deleted\n            - critical_deletes: Number of CRITICAL risk resources being deleted\n\n    Returns:\n        A dictionary containing:\n            - level: Risk level string (LOW, MEDIUM, HIGH)\n            - score: Numeric risk score (10, 50, or 90)\n            - reasons: List of reason strings explaining the assessment\n            - stats: The original stats dictionary\n    \"\"\"\n    level = \"LOW\"\n    reasons: List[str] = []\n    deletes = stats[\"deletes\"]\n    total = stats[\"total_resources\"]\n\n    # \ud83d\udca5 USE NEW STATS \ud83d\udca5\n    high_changes = stats[\"high_risk_changes\"]\n    crit_changes = stats[\"critical_changes\"]\n    high_deletes = stats[\"high_risk_deletes\"]\n    crit_deletes = stats[\"critical_deletes\"]\n\n    # 1. Base Signals (for informational purposes)\n    if total &gt; 0:\n        reasons.append(f\"{total} resource(s) will be changed (create/update/delete).\")\n    if deletes &gt; 0:\n        reasons.append(f\"{deletes} resource(s) will be deleted.\")\n\n    # 2. Risk Rules (Tuned to prioritize CRITICAL changes)\n\n    # A. No changes at all\n    if total == 0:\n        level = \"LOW\"\n        reasons = [\"No resource changes detected in plan.\"]\n        return {\n            \"level\": level,\n            \"score\": score_from_level(level),\n            \"reasons\": reasons,\n            \"stats\": stats,\n        }\n\n    # B. CRITICAL Resource Rules (Highest Priority)\n    if crit_deletes &gt; 0:\n        level = max_level(level, \"HIGH\")\n        reasons.append(f\"{crit_deletes} CRITICAL resource(s) will be **deleted**.\")\n    if crit_changes &gt; 0:\n        level = max_level(level, \"MEDIUM\")\n        reasons.append(f\"{crit_changes} CRITICAL resource(s) will be changed.\")\n\n    # C. HIGH Resource Rules\n    if high_deletes &gt; 0:\n        level = max_level(level, \"MEDIUM\")\n        reasons.append(f\"{high_deletes} HIGH risk resource(s) will be deleted.\")\n    if high_changes &gt; 0:\n        level = max_level(level, \"LOW\")  # Bump to MEDIUM if LOW, but keep it if already MEDIUM/HIGH\n        reasons.append(f\"{high_changes} HIGH risk resource(s) will be changed.\")\n\n    # D. Blast Radius Rules (Optional, remains similar)\n    if total &gt; 20 or deletes &gt; 5:\n        level = max_level(level, \"HIGH\")\n        reasons.append(\"High count of changes or deletions (Blast Radius).\")\n    elif total &gt; 5:\n        level = max_level(level, \"MEDIUM\")\n\n    score = score_from_level(level)\n\n    return {\n        \"level\": level,\n        \"score\": score,\n        \"reasons\": reasons,\n        \"stats\": stats,\n    }\n</code></pre>"},{"location":"api/risk/#terraguard.risk.rules.max_level","title":"<code>max_level(current, new)</code>","text":"<p>Return the higher risk level between two risk levels.</p> <p>Parameters:</p> Name Type Description Default <code>current</code> <code>str</code> <p>Current risk level string.</p> required <code>new</code> <code>str</code> <p>New risk level string to compare.</p> required <p>Returns:</p> Type Description <code>str</code> <p>The risk level string with higher severity (new if it's higher,</p> <code>str</code> <p>current otherwise).</p> Note <p>Risk levels are compared using their order in RISK_LEVEL_ORDER.</p> Source code in <code>src/terraguard/risk/rules.py</code> <pre><code>def max_level(current: str, new: str) -&gt; str:\n    \"\"\"Return the higher risk level between two risk levels.\n\n    Args:\n        current: Current risk level string.\n        new: New risk level string to compare.\n\n    Returns:\n        The risk level string with higher severity (new if it's higher,\n        current otherwise).\n\n    Note:\n        Risk levels are compared using their order in RISK_LEVEL_ORDER.\n    \"\"\"\n    if RISK_LEVEL_ORDER.index(new) &gt; RISK_LEVEL_ORDER.index(current):\n        return new\n    return current\n</code></pre>"},{"location":"api/risk/#terraguard.risk.rules.score_from_level","title":"<code>score_from_level(level)</code>","text":"<p>Convert a risk level string to a numeric score.</p> <p>Parameters:</p> Name Type Description Default <code>level</code> <code>str</code> <p>Risk level string (LOW, MEDIUM, or HIGH).</p> required <p>Returns:</p> Type Description <code>int</code> <p>Numeric score: 10 for LOW, 50 for MEDIUM, 90 for HIGH, 0 for unknown.</p> Source code in <code>src/terraguard/risk/rules.py</code> <pre><code>def score_from_level(level: str) -&gt; int:\n    \"\"\"Convert a risk level string to a numeric score.\n\n    Args:\n        level: Risk level string (LOW, MEDIUM, or HIGH).\n\n    Returns:\n        Numeric score: 10 for LOW, 50 for MEDIUM, 90 for HIGH, 0 for unknown.\n    \"\"\"\n    if level == \"LOW\":\n        return 10\n    if level == \"MEDIUM\":\n        return 50\n    if level == \"HIGH\":\n        return 90\n    return 0\n</code></pre>"},{"location":"api/terraform-plan/","title":"Terraform Plan Processing","text":"<p>Modules for loading and analyzing Terraform plan JSON files.</p>"},{"location":"api/terraform-plan/#plan-loader","title":"Plan Loader","text":"<p>Loads and parses Terraform plan JSON files.</p> <p>Terraform plan JSON file loading.</p> <p>This module provides functionality to load and parse Terraform plan JSON files generated from <code>terraform show -json</code>.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/terraform-plan/#terraguard.terraform_plan.loader.load_plan_json","title":"<code>load_plan_json(path)</code>","text":"<p>Load and parse a Terraform plan JSON file.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str</code> <p>File system path to the Terraform plan JSON file.</p> required <p>Returns:</p> Type Description <code>Dict[str, Any]</code> <p>A dictionary containing the parsed Terraform plan data.</p> <p>Raises:</p> Type Description <code>FileNotFoundError</code> <p>If the file does not exist.</p> <code>JSONDecodeError</code> <p>If the file contains invalid JSON.</p> <code>OSError</code> <p>If the file cannot be read.</p> Source code in <code>src/terraguard/terraform_plan/loader.py</code> <pre><code>def load_plan_json(path: str) -&gt; Dict[str, Any]:\n    \"\"\"Load and parse a Terraform plan JSON file.\n\n    Args:\n        path: File system path to the Terraform plan JSON file.\n\n    Returns:\n        A dictionary containing the parsed Terraform plan data.\n\n    Raises:\n        FileNotFoundError: If the file does not exist.\n        json.JSONDecodeError: If the file contains invalid JSON.\n        OSError: If the file cannot be read.\n    \"\"\"\n    with open(path, encoding=\"utf-8\") as f:\n        return cast(Dict[str, Any], json.load(f))\n</code></pre>"},{"location":"api/terraform-plan/#change-summarizer","title":"Change Summarizer","text":"<p>Analyzes Terraform plan changes and categorizes them by risk level.</p> <p>Terraform plan change summarization.</p> <p>This module analyzes Terraform plan data and produces statistics about resource changes, categorizing them by risk level and action type.</p> <p>options: show_root_heading: true show_root_toc_entry: true members_order: source show_source: true</p>"},{"location":"api/terraform-plan/#terraguard.terraform_plan.summarizer.summarize_changes","title":"<code>summarize_changes(plan, risk_config)</code>","text":"<p>Summarize changes in a Terraform plan and categorize by risk level.</p> <p>Analyzes resource changes in the plan, counts actions (create/update/delete), and maps each resource to its risk level using the provided configuration.</p> <p>Parameters:</p> Name Type Description Default <code>plan</code> <code>Dict[str, Any]</code> <p>Terraform plan dictionary containing a \"resource_changes\" list.</p> required <code>risk_config</code> <code>Dict[str, Any]</code> <p>Risk configuration dictionary used to map resource types to risk levels.</p> required <p>Returns:</p> Type Description <code>Dict[str, Any]</code> <p>A dictionary containing statistics: - total_resources: Total number of resources with changes - creates: Number of create actions - updates: Number of update actions - deletes: Number of delete actions - high_risk_changes: Number of HIGH risk resources changing - critical_changes: Number of CRITICAL risk resources changing - high_risk_deletes: Number of HIGH risk resources being deleted - critical_deletes: Number of CRITICAL risk resources being deleted - sensitive_details: List of tuples (rtype, address, risk_level, actions)     for HIGH and CRITICAL risk resources</p> Source code in <code>src/terraguard/terraform_plan/summarizer.py</code> <pre><code>def summarize_changes(plan: Dict[str, Any], risk_config: Dict[str, Any]) -&gt; Dict[str, Any]:\n    \"\"\"Summarize changes in a Terraform plan and categorize by risk level.\n\n    Analyzes resource changes in the plan, counts actions (create/update/delete),\n    and maps each resource to its risk level using the provided configuration.\n\n    Args:\n        plan: Terraform plan dictionary containing a \"resource_changes\" list.\n        risk_config: Risk configuration dictionary used to map resource types\n            to risk levels.\n\n    Returns:\n        A dictionary containing statistics:\n            - total_resources: Total number of resources with changes\n            - creates: Number of create actions\n            - updates: Number of update actions\n            - deletes: Number of delete actions\n            - high_risk_changes: Number of HIGH risk resources changing\n            - critical_changes: Number of CRITICAL risk resources changing\n            - high_risk_deletes: Number of HIGH risk resources being deleted\n            - critical_deletes: Number of CRITICAL risk resources being deleted\n            - sensitive_details: List of tuples (rtype, address, risk_level, actions)\n                for HIGH and CRITICAL risk resources\n    \"\"\"\n    resource_changes = plan.get(\"resource_changes\", [])\n    stats: Dict[str, Any] = {\n        \"total_resources\": len(resource_changes),\n        \"creates\": 0,\n        \"updates\": 0,\n        \"deletes\": 0,\n        \"high_risk_changes\": 0,  # New stat\n        \"critical_changes\": 0,  # New stat\n        \"high_risk_deletes\": 0,  # New stat\n        \"critical_deletes\": 0,  # New stat\n        \"sensitive_details\": [],\n    }\n    # sensitive_details will now track HIGH/CRITICAL resources\n    high_critical_details: List[Tuple[str, str, str, List[str]]] = []\n\n    for rc in resource_changes:\n        rtype = rc.get(\"type\", \"\")\n        address = rc.get(\"address\", f\"{rtype}.{rc.get('name', 'unknown')}\")\n        change = rc.get(\"change\", {})\n        actions: List[str] = change.get(\"actions\", [])\n\n        # 1. Count basic stats\n        if \"create\" in actions:\n            stats[\"creates\"] = stats.get(\"creates\", 0) + 1\n        if \"update\" in actions:\n            stats[\"updates\"] = stats.get(\"updates\", 0) + 1\n        if \"delete\" in actions:\n            stats[\"deletes\"] = stats.get(\"deletes\", 0) + 1\n\n        # 2. Map resource risk using the new configuration\n        risk_level, _ = map_risk_level(\n            rtype, risk_config\n        )  # Assuming map_risk_level returns (level, reason)\n\n        # 3. Count changes based on mapped risk level\n        if risk_level == \"HIGH\" and any(a in actions for a in (\"create\", \"update\", \"delete\")):\n            stats[\"high_risk_changes\"] = stats.get(\"high_risk_changes\", 0) + 1\n            if \"delete\" in actions:\n                stats[\"high_risk_deletes\"] = stats.get(\"high_risk_deletes\", 0) + 1\n            high_critical_details.append((rtype, address, risk_level, actions))\n\n        elif risk_level == \"CRITICAL\" and any(a in actions for a in (\"create\", \"update\", \"delete\")):\n            stats[\"critical_changes\"] = stats.get(\"critical_changes\", 0) + 1\n            if \"delete\" in actions:\n                stats[\"critical_deletes\"] = stats.get(\"critical_deletes\", 0) + 1\n            high_critical_details.append((rtype, address, risk_level, actions))\n\n    stats[\"sensitive_details\"] = high_critical_details\n    return stats\n</code></pre>"}]}